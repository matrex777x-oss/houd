<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>Attendance Processor (Offline)</title>
  <link rel="stylesheet" href="style.css">
  <!-- Dynamic @page (updated from JS for portrait/landscape) -->
  <style id="pageStyle">
    @page { size: A4 portrait; margin: 12mm; }
  </style>
</head>

<body>
<header class="topbar">
  <div class="brand">
    <div class="logo">โฑ๏ธ</div>
    <div>
      <h1>ูุนุงูุฌ ุงูุญุถูุฑ ูุงูุงูุตุฑุงู</h1>
      <div class="sub">ูุนูู ุจุฏูู ุฅูุชุฑูุช โข ูุตู โ ุชูุธูู โ ุชูุงุฑูุฑ โ ุทุจุงุนุฉ/PDF</div>
    </div>
  </div>

  <div class="topActions noPrint">
    <button id="btnTheme" class="ghost" title="ุชุจุฏูู ุงููุถุน">๐</button>
    <button id="btnPrint" class="primary" title="ุทุจุงุนุฉ / ุญูุธ PDF">Print / PDF</button>
  </div>
</header>

<main>
  <!-- โ Print header (ONLY for printing) -->
  <section id="printHeader" class="printOnly">
    <div class="phTop">
      <div>
        <div class="phCompany" id="phCompany">Attendance Report</div>
        <div class="phMeta">
          <span id="phReportTitle">โ</span>
          <span class="dot">โข</span>
          <span id="phRange">โ</span>
        </div>
      </div>
      <div class="phRight">
        <div><b>Generated:</b> <span id="phGen">โ</span></div>
        <div><b>Employee:</b> <span id="phEmp">โ</span></div>
      </div>
    </div>

    <div class="phBottom">
      <div><b>Prepared by:</b> <span id="phPrepared">โ</span></div>
      <div><b>Approved by:</b> <span id="phApproved">โ</span></div>
      <div><b>Notes:</b> <span id="phNotes">โ</span></div>
    </div>
  </section>

  <div class="layout">
    <!-- LEFT: INPUT (hidden on print) -->
    <section class="card noPrint">
      <div class="cardHead">
        <div>
          <div class="cardTitle">1) ุฅุฏุฎุงู ุงูุจูุงูุงุช</div>
          <div class="cardSub">ุงูุตู ุงูุจูุงูุงุช ุงูุฎุงู ููุง ูู (TAB ูุซู Excel ุฃู ูุณุงูุงุช)</div>
        </div>

        <div class="cardHeadActions">
          <button class="primary" id="btnProcess">Process</button>
          <button class="danger" id="btnClear">Clear</button>
        </div>
      </div>

      <textarea id="raw" placeholder="ูุซุงู:
7\tareef\tNot Set1\t01/12/2025 01:04:17\t1
8\tsifat\tNot Set1\t01/12/2025 01:04:28\t1
..."></textarea>

      <div class="controls">
        <div class="pill">
          ุณูุงุญูุฉ ุงูุชุฃุฎูุฑ
          <input id="grace" type="number" min="0" step="1" value="15">
          <span>ุฏูููุฉ</span>
        </div>

        <div class="pill">
          ุจุตูุงุช ุจุนุฏ ููุชุตู ุงูููู ุชููุณุจ ููููู ุงูุณุงุจู ุฅุฐุง ุงูููุช &lt;
          <input id="rollHour" type="number" min="0" max="23" step="1" value="6">
          <span>:00</span>
        </div>

        <!-- โ pushed far left -->
        <div class="pill pushLeft" title="ุงูุจุตูุงุช ุงูุชู ุชุชูุฑุฑ ุฎูุงู ุฃูู ูู (N) ุซุงููุฉ ุณูุชู ุชุฌุงูููุง">
          ุญุฐู ุชูุฑุงุฑ ุฃูู ูู
          <input id="dedup" type="number" min="0" step="1" value="60">
          <span>ุซุงููุฉ</span>
        </div>
      </div>

      <div class="hint">
        <b>ูุฏุนูู:</b>
        โข 5 ุฃุนูุฏุฉ: <code>ID  Name  Dept  DateTime  DeviceID</code>
        โข 6 ุฃุนูุฏุฉ: <code>ID  Name  Dept  Date  Time  DeviceID</code>
        โข ูุฏุนู <code>ุต/ู</code>.
      </div>

      <div class="status" id="status"></div>

      <div class="kpi" id="kpi" style="display:none;">
        <div class="k"><div class="l">Raw rows</div><div class="n" id="kRaw">0</div></div>
        <div class="k"><div class="l">After clean</div><div class="n" id="kClean">0</div></div>
        <div class="k"><div class="l">Daily rows</div><div class="n" id="kDaily">0</div></div>
        <div class="k"><div class="l">Employees</div><div class="n" id="kEmp">0</div></div>
      </div>
    </section>

    <!-- RIGHT: REPORTS -->
    <section class="card">
      <div class="cardHead">
        <div>
          <div class="cardTitle">2) ุงูุชูุงุฑูุฑ</div>
          <div class="cardSub">ุงุฎุชุฑ ุงูุดูุฑ/ุงูููุธู ุซู ุงุทุจุน ุฃู ุตุฏูุฑ TSV ููุชุญูุง ูู Excel</div>
        </div>

        <div class="toolsRow">
          <button id="btnExportPunches" class="ghost">TSV Punches</button>
          <button id="btnExportDaily" class="ghost">TSV Daily</button>
          <button id="btnExportSummary" class="ghost">TSV Summary</button>
          <button id="btnXlsxSummary" class="ghost">XLSX Summary</button>
          <button id="btnXlsxDaily" class="ghost">XLSX Daily</button>
          <button id="btnXlsxPunches" class="ghost">XLSX Punches</button>
          <button id="btnXlsxEmployee" class="ghost">XLSX Employee</button>
        </div>
      </div>

      <!-- โ Print options -->
      <details class="drop noPrint" open>
        <summary>ุฎูุงุฑุงุช ุงูุทุจุงุนุฉ / PDF</summary>
        <div class="dropBody">
          <div class="formGrid3">
            <label>ุงุชุฌุงู ุงูุตูุญุฉ
              <select id="printOrientation">
                <option value="portrait">ุนููุฏู (Portrait)</option>
                <option value="landscape">ุฃููู (Landscape)</option>
              </select>
            </label>

            <label>ูุงุฐุง ุชุฑูุฏ ุทุจุงุนุชูุ
              <select id="printWhat">
                <option value="current">ุงูุชุจููุจ ุงูุญุงูู</option>
                <option value="punches">ุฌุฏูู ุงูุจุตูุงุช (Cleaned Punches)</option>
                <option value="daily">ุงูุฏูุงู ุงููููู (Daily Attendance)</option>
                <option value="summary">ููุฎุต ุดูุฑู (Monthly Summary)</option>
                <option value="emp">ุชูุฑูุฑ ููุธู (Employee Report)</option>
              </select>
            </label>

            <label>ุชุญุณูู ุงูููุงุกูุฉ ููุทุจุงุนุฉ
              <select id="printFit">
                <option value="normal">ุนุงุฏู</option>
                <option value="compact">ูุถุบูุท (ุฎุท ุฃุตุบุฑ)</option>
                <option value="wide">ุฃุนูุฏุฉ ุฃูุณุน (ุฃูุถู ููุฃููู)</option>
              </select>
            </label>
          
          <div class="hr"></div>

          <div class="hint"><b>Daily Attendance:</b> ุงุฎุชุฑ ุงูุฃุนูุฏุฉ ุงูุชู ุชุฑูุฏ ุฅุฎูุงุกูุง ูู ุงูุทุจุงุนุฉ (ููุทุจู ุฃูุถุงู ุนูู Employee Daily).</div>

          <div class="colPicker">
            <div class="colPickerHead">
              <div class="colPickerTitle">ุฅุฎูุงุก ุฃุนูุฏุฉ (Daily)</div>
              <div class="colPickerBtns">
                <button type="button" class="ghost" id="btnDailyMinimal">Minimal</button>
                <button type="button" class="ghost" id="btnDailyReset">Reset</button>
              </div>
            </div>

            <div class="colGrid" id="dailyColGrid">
              <!-- JS fills checkboxes -->
            </div>
          </div>
</div>

          <div class="formGrid3" style="margin-top:10px;">
            <label>ุงุณู ุงูููุดุฃุฉ/ุงููุฑุน
              <input id="hdrCompany" placeholder="ูุซุงู: ุดุฑูุฉ ... / ูุฑุน ..." value="Attendance Report">
            </label>
            <label>Prepared by
              <input id="hdrPrepared" placeholder="ุงูุงุณู">
            </label>
            <label>Approved by
              <input id="hdrApproved" placeholder="ุงูุงุณู">
            </label>
          </div>

          <div class="formGrid3" style="margin-top:10px;">
            <label style="grid-column: 1 / -1;">Notes
              <input id="hdrNotes" placeholder="ููุงุญุธุงุช">
            </label>
          </div>

          <div class="hint">
            โข ุฒุฑ <b>Print / PDF</b> ุณููุชุญ ูุงูุฐุฉ ุงูุทุจุงุนุฉ. ุงุฎุชุฑ โSave as PDFโ ูุฅุฎุฑุงุฌ PDF.<br>
            โข ูู ุงูุทุจุงุนุฉ ูู ูุธูุฑ ูุณู ุฅุฏุฎุงู ุงูุจูุงูุงุช ููุง ุฅุนุฏุงุฏุงุช ุงูุฏูุงู.
          </div>
        </div>
      </details>

      <!-- โ Schedule editor -->
      <details class="drop noPrint">
        <summary>ุชุนุฏูู ุฃููุงุช ุงูุฏูุงู (ูุงุฆูุฉ ูุงููุฉ ููู ุงููุนุฑูุงุช)</summary>
        <div class="dropBody">
          <div class="hint">
            โข ุจุนุฏ ุงูุถุบุท ุนูู <b>Process</b> ุณูุชู ุฅูุดุงุก ุฌุฏูู ูู <b>1</b> ุฅูู <b>ุขุฎุฑ ูุนุฑู</b> ุชููุงุฆููุง.<br>
            โข ุงูููุธู ID=1 ูุนุชุจุฑ <b>Manager</b> (ูุง ุชูุทุจู ุนููู ุฃุญูุงู ุงูุชุฃุฎูุฑ/ุงูุฅุถุงูู/ุงูุบูุงุจ).<br>
            โข ุฅุฐุง ุจุตู ุงูููุธู <b>ูุฑุฉ ูุงุญุฏุฉ</b> ูุชู ุงุนุชุจุงุฑู ุญุงุถุฑ ูููู <b>ุบูุฑ ููุชุธู</b>.
          </div>

          <div class="row" style="margin-top:10px;">
            <button id="btnApplySchedule" class="primary">Apply Schedule + Recalculate</button>
            <button id="btnExportSchedule" class="ghost">Export Schedule (TSV)</button>
            <input id="importScheduleFile" type="file" accept=".tsv,.txt,.csv" style="display:none">
            <button id="btnImportSchedule" class="ghost">Import Schedule (TSV)</button>
          </div>

          <div class="tablewrap scheduleWrap" style="margin-top:10px;">
            <table id="tblSchedule"></table>
          </div>
        </div>
      </details>

      <!-- Filters + KPIs -->
      <div class="filters noPrint">
        <div class="pill">
          ููุชุฑุฉ ุงูุดูุฑ
          <select id="monthFilter">
            <option value="ALL">ูู ุงูุจูุงูุงุช</option>
          </select>
        </div>

        <div class="pill">
          ุงุฎุชุฑ ุงูููุธู
          <select id="employeeFilter">
            <option value="ALL">ูู ุงูููุธููู</option>
          </select>
        </div>

        <div class="pill bestOnly">
          ุฃูุถู ููุธู: <b id="bestEmp">โ</b>
        </div>
      </div>

      <!-- Tabs -->
      <div class="tabs noPrint">
        <div class="tab active" data-tab="punches">Cleaned Punches</div>
        <div class="tab" data-tab="daily">Daily Attendance</div>
        <div class="tab" data-tab="summary">Monthly Summary</div>
        <div class="tab" data-tab="emp">Employee Report</div>
      </div>

      <!-- Views -->
      <div id="viewPunches" class="view">
        <div class="tablewrap"><table id="tblPunches"></table></div>
      </div>

      <div id="viewDaily" class="view" style="display:none;">
        <div class="tablewrap"><table id="tblDaily"></table></div>
      </div>

      <div id="viewSummary" class="view" style="display:none;">
        <div class="tablewrap"><table id="tblSummary"></table></div>
      </div>

      <div id="viewEmp" class="view" style="display:none;">
        <div class="hint noPrint">ูุฐุง ุงูุชูุฑูุฑ ูุธูุฑ ุนูุฏ ุงุฎุชูุงุฑ ููุธู ูุญุฏุฏ ูู ุงููุงุฆูุฉ.</div>

        <div class="kpi" id="empKpi" style="margin-top:12px; display:none;">
          <div class="k"><div class="l">ุฃูุงู ุงูุญุถูุฑ</div><div class="n" id="eDaysP">0</div></div>
          <div class="k"><div class="l">ุฃูุงู ุงูุบูุงุจ</div><div class="n" id="eDaysA">0</div></div>
          <div class="k"><div class="l">ูุฌููุน ุงูุชุฃุฎูุฑ (ุฏูููุฉ)</div><div class="n" id="eLate">0</div></div>
          <div class="k"><div class="l">ูุฌููุน ุงูุฅุถุงูู (ุฏูููุฉ)</div><div class="n" id="eOT">0</div></div>
        </div>

        <div class="kpi kpi3" id="empKpi2" style="margin-top:10px; display:none;">
          <div class="k"><div class="l">ุณุงุนุงุช ุงูุนูู</div><div class="n" id="eWorkH">0</div></div>
          <div class="k"><div class="l">ุฃูู ุจุตูุฉ</div><div class="n" id="eFirst">โ</div></div>
          <div class="k"><div class="l">ุขุฎุฑ ุจุตูุฉ</div><div class="n" id="eLast">โ</div></div>
        </div>

        <div class="row noPrint" style="margin-top:12px;">
          <button id="btnExportEmpDaily" class="ghost">TSV Employee Daily</button>
          <button id="btnExportEmpPunches" class="ghost">TSV Employee Punches</button>
        </div>

        <div class="hint"><b>ุงูุฏูุงู ุงููููู ููููุธู (ูุน ุตู ุงููุฌููุน):</b></div>
        <div class="tablewrap"><table id="tblEmpDaily"></table></div>

        <div class="hint" style="margin-top:14px"><b>ุจุตูุงุช ุงูููุธู (ุจุนุฏ ุงูุชูุธูู):</b></div>
        <div class="tablewrap"><table id="tblEmpPunches"></table></div>
      </div>

      <div class="hint noPrint">
        <b>ููุงุญุธุฉ:</b> ุงูุชุตุฏูุฑ TSV (Tab) ุญุชู ุชูุชุญ ุงูุฃุนูุฏุฉ ุตุญูุญุฉ ูู Excel.
      </div>
    </section>
  </div>
</main>

<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
  <script src="app.js"></script>
</body>
</html>
